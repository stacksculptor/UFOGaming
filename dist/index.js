import{useState as m,useRef as v,useLayoutEffect as F,useEffect as y}from"react";const a=typeof window!="undefined"||typeof document!="undefined"?F:y,f=(c,r)=>c===r,d={};function w(c,r=f){const n=v(d);let t=n.current;return a(()=>{n.current=t}),(n.current===d||!r(c,n.current))&&(t=c),t}export function newRidgeState(c,r){let n=[],t=c;function T(e,u){const o=t;t=e instanceof Function?e(t):e,setTimeout(()=>{var i;n.forEach(p=>p(t,o)),u==null||u(t,o),(i=r==null?void 0:r.onSet)==null||i.call(r,t,o)})}function s(e){return n.push(e),()=>{n=n.filter(u=>u!==e)}}function b(e){a(()=>s(e),[e])}function S(){const[e,u]=m(t);return b(u),[e,T]}function l(e,u=f){const[o]=S();return w(e(o),u)}return{use:S,useSelector:l,useValue:()=>S()[0],get:()=>t,set:T,reset:()=>T(c),subscribe:s}}
